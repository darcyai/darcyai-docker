parameters:
  - name: imageName
    type: string
  - name: imageTag
    type: string
  - name: dockerFile
    type: string
  - name: imageNameSuffix
    type: string
  - name: step
    type: string
  - name: isArm
    type: string

steps:
  - task: Docker@2
    displayName: Build ${{ parameters.step }} image
    inputs:
      repository: ${{ parameters.imageName }}
      command: build
      Dockerfile: ${{ parameters.dockerFile }}
      tags: |
        ${{ parameters.imageTag }}
      arguments: --build-arg BASE_IMAGE_TAG=${{ parameters.imageTag }} --build-arg BASE_IMAGE_SUFFIX=${{ parameters.imageNameSuffix }} --build-arg IS_ARM=${{ parameters.isArm }}
  - task: Docker@2
    displayName: Push ${{ parameters.step }} image
    inputs:
      containerRegistry: 'Edgeworx-Dockerhub'
      repository: ${{ parameters.imageName }}
      command: push
      Dockerfile: ${{ parameters.dockerFile }}
      tags: |
        ${{ parameters.imageTag }}
